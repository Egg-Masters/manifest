<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gem Spider - Token Pre Sale</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://unpkg.com/tonweb"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: #fff; text-align: center; margin: 0; padding: 0; }
        .header { padding: 20px; animation: fadeIn 1.5s ease-in-out; }
        .logo img { animation: pulse 2s infinite; }
        .main-content { display: flex; justify-content: center; align-items: center; height: 80vh; }
        .card { background: rgba(255, 255, 255, 0.1); padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); width: 350px; animation: slideUp 1s ease-in-out; }
        .btn-primary, .btn-success, .btn-danger { width: 100%; padding: 10px; margin-top: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-hover:hover { opacity: 0.8; }
        .footer { padding: 15px; background: rgba(0, 0, 0, 0.2); position: fixed; bottom: 0; width: 100%; }
        .social-icons a { color: white; margin: 0 10px; font-size: 20px; transition: transform 0.3s; }
        .social-icons a:hover { transform: scale(1.2); }
        .balance-container { margin-top: 20px; text-align: center; }
        .balance-label { font-weight: bold; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="logo.png" alt="Gem Spider Logo" width="50">
        </div>
        <h1>Gem Spider</h1>
        <p>Token Pre Sale - Get your $SPIDER tokens now!</p>
    </header>
    <main class="main-content">
        <div class="card">
            <h2>Wallet Connection</h2>
            <div id="ton-connect"></div>
            <div class="balance-container">
                <p class="balance-label">TON Balance:</p>
                <p id="ton-balance">0 TON</p>
                <p class="balance-label">$SPIDEY Balance:</p>
                <p id="spidey-balance">0 SPIDEY</p>
            </div>
            <div class="buy-section">
                <h2>Buy $SPIDER Tokens</h2>
                <input type="number" id="amount-input" placeholder="Enter TON amount">
                <button id="buy-tokens-btn" class="btn-success btn-hover" disabled>Buy $SPIDER</button>
                <p id="transaction-status" class="status"></p>
            </div>
        </div>
    </main>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            console.log("üì¢ DOM Loaded, Initializing TonConnect & TonWeb...");
            if (typeof TON_CONNECT_UI !== "undefined") {
                const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://markmon08.github.io/Gem-SPIDER/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect'
                });
                const tonweb = new TonWeb();
                const buyButton = document.getElementById("buy-tokens-btn");
                const amountInput = document.getElementById("amount-input");
                const tonBalanceElem = document.getElementById("ton-balance");
                let userWallet = null;
                const recipientAddress = "UQAVhdnM_-BLbS6W4b1BF5UyGWuIapjXRZjNJjfve7StCqST";
                function formatBalance(balance) { return (balance / 1e9).toFixed(6).replace(/\.0+$/, ""); }
                async function fetchBalances(walletAddress) {
                    try {
                        const response = await fetch(`https://tonapi.io/v2/accounts/${walletAddress}`);
                        const data = await response.json();
                        tonBalanceElem.textContent = data.balance ? formatBalance(data.balance) : "0";
                    } catch (error) {
                        console.error("‚ö†Ô∏è Error Fetching Balances:", error);
                    }
                }
                async function sendTransaction() {
                    const amount = parseFloat(amountInput.value);
                    if (isNaN(amount) || amount <= 0) {
                        alert("Please enter a valid TON amount.");
                        return;
                    }
                    try {
                        const transaction = {
                            validUntil: Math.floor(Date.now() / 1000) + 300,
                            messages: [{ address: recipientAddress, amount: (amount * 1e9).toString() }]
                        };
                        await tonConnectUI.sendTransaction(transaction);
                        alert("Transaction sent successfully!");
                    } catch (error) {
                        console.error("‚ö†Ô∏è Transaction Failed:", error);
                        alert("Transaction failed: " + error.message);
                    }
                }
                async function updateWalletStatus() {
                    const connectedWallet = await tonConnectUI.getWallet();
                    if (connectedWallet && connectedWallet.account) {
                        userWallet = connectedWallet.account.address;
                        await fetchBalances(userWallet);
                        buyButton.disabled = false;
                    } else {
                        buyButton.disabled = true;
                    }
                }
                tonConnectUI.onStatusChange(updateWalletStatus);
                setTimeout(updateWalletStatus, 1000);
                buyButton.addEventListener("click", sendTransaction);
            } else {
                console.error("TON_CONNECT_UI is not defined. Make sure the script is loaded properly.");
            }
        });
    </script>
</body>
</html>
